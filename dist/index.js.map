{"version":3,"file":"index.js","names":["global","factory","exports","module","define","amd","m3","version","baseUrl","sessionid","ajax","opts","_url","url","indexOf","xhr","XMLHttpRequest","type","dataType","toUpperCase","params","obj","str","prop","slice","length","data","open","contentType","setRequestHeader","send","Promise","resolve","reject","onload","status","result","JSON","parse","response","e","connect","port","company","username","password","join","then","rtn","message","globalHandler","catch","err","console","log","callFS","fileName","input","rt","Object","defineProperty","value"],"mappings":"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","sources":["m3js/src/index.js"],"sourcesContent":["/**\n * Copyright (c) 2020, Wecise\n * All rights reserved.\n */\n\n(function(global, factory) {\n\ttypeof exports === \"object\" && typeof module !== \"undefined\"\n\t\t? factory(exports)\n\t\t: typeof define === \"function\" && define.amd\n\t\t\t? define([\"exports\"], factory)\n\t\t\t: factory(global.m3 = global.m3 || {});\n})(\n\tthis,\n\tfunction(exports) {\n\t\t\"use strict\";\n\t\tlet version = \"1.0.0\";\n\n\t\t/**\n   * **Note:** This method mutates `object`.\n   *\n   * @static\n   * @memberOf _\n   * @since 1.0.0\n   * @category \n   * @param \n   * @returns \n   * @example\n   *\n   */\n\n\t\t/* \n   *  sessionid for M3 platform\n  */\n\t\tlet baseUrl = \"\";\n\t\tlet sessionid = \"\";\n\n\t\tfunction ajax(opts) {\n\t\t\tlet _url = \"\";\n\n\t\t\tif (opts.url.indexOf(\"http://\") === -1) {\n\t\t\t\t_url = `${baseUrl}${opts.url}&sessionid=${sessionid}`;\n\t\t\t} else {\n\t\t\t\t_url = opts.url;\n\t\t\t}\n\n\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\tvar type = opts.type || \"GET\";\n\t\t\tlet url = _url;\n\t\t\t//var params = opts.data;\n\t\t\tlet dataType = opts.dataType || \"json\";\n\t\t\ttype = type.toUpperCase();\n\n\t\t\tif (type === \"GET\") {\n\t\t\t\tparams = function(obj) {\n\t\t\t\t\tlet str = \"\";\n\n\t\t\t\t\tfor (let prop in obj) {\n\t\t\t\t\t\tstr += `${prop}=${obj[prop]}&`;\n\t\t\t\t\t}\n\t\t\t\t\tstr = str.slice(0, str.length - 1);\n\t\t\t\t\treturn str;\n\t\t\t\t}(opts.data);\n\t\t\t\turl += url.indexOf(\"?\") === -1 ? `?${params}` : `&${params}`;\n\t\t\t}\n\n\t\t\txhr.open(type, url);\n\n\t\t\tif (opts.contentType) {\n\t\t\t\txhr.setRequestHeader(\"Content-type\", opts.contentType);\n\t\t\t}\n\n\t\t\txhr.send(params ? params : null);\n\n\t\t\t//return promise\n\t\t\treturn new Promise(function(resolve, reject) {\n\t\t\t\t//onload are executed just after the sync request is compleï¼Œ\n\t\t\t\t//please use 'onreadystatechange' if need support IE9-\n\t\t\t\txhr.onload = function() {\n\t\t\t\t\tif (xhr.status === 200) {\n\t\t\t\t\t\tvar result;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = JSON.parse(xhr.response);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tresult = xhr.response;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject(xhr.response);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t\t/* \n   *  connect to M3 platform and return sessionid \n  */\n\t\tlet connect = async function(url, port, company, username, password) {\n\t\t\tbaseUrl = `http://${[url, port].join(\":\")}`;\n\t\t\tlet opts = {\n\t\t\t\turl: `${baseUrl}/user/signin?company=${company}&username=${username}&password=${password}`,\n\t\t\t\ttype: \"post\",\n\t\t\t};\n\t\t\tawait ajax(opts).then((rtn) => {\n\t\t\t\tsessionid = rtn.message;\n\t\t\t\tglobalHandler();\n\t\t\t}).catch((err) => {\n\t\t\t\tconsole.log(err);\n\t\t\t});\n\t\t};\n\n\t\t/* \n   *  Get global register info for M3 platform\n   */\n\t\tlet globalHandler = async function() {\n\t\t\tawait callFS(\"/matrix/utils/global.js\", null).then((rtn) => {\n\t\t\t\texports.global = rtn.message;\n\t\t\t});\n\t\t};\n\n\t\t/* \n   *  Get global register info by username for M3 platform\n   */\n\t\t// let globalByUserHandler = function(parent, name) {\n\t\t// \tlet opts = {url: `/fs${parent}/${name}&type=file`};\n\t\t// \tajax(opts).then((rtn) => {\n\t\t// \t\tglobalByUser = rtn;\n\t\t// \t}).catch((err) => {\n\t\t// \t\tglobalByUser = err;\n\t\t// \t});\n\t\t// };\n\n\t\t/* \n   *  Call a serverJS interface for M3 platform\n   */\n\t\tlet callFS = async function(fileName, input) {\n\t\t\tlet opts = {\n\t\t\t\turl: `/script/exec/js?filepath=${fileName}&input=${input}&isfile=true`,\n\t\t\t};\n\t\t\tlet rt = null;\n\t\t\tawait ajax(opts).then((rtn) => {\n\t\t\t\trt = rtn;\n\t\t\t}).catch((err) => {\n\t\t\t\trt = err;\n\t\t\t});\n\n\t\t\treturn rt;\n\t\t};\n\n\t\t// let topBar = function() {};\n\n\t\t// let leftBar = function() {};\n\n\t\t// let rightBar = function() {};\n\n\t\t// let footBar = function() {};\n\n\t\texports.sessionid = sessionid;\n\t\texports.version = version;\n\t\texports.connect = connect;\n\t\texports.callFS = callFS;\n\n\t\tObject.defineProperty(exports, \"__esModule\", {value: true});\n\t},\n);\n"]}